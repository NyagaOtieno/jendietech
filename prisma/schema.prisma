generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  name          String
  email         String         @unique
  role          Role
  region        String?
  password      String
  online        Boolean        @default(false)
  lastLogin     DateTime?
  lastLogout    DateTime?
  phone         Int            @unique
  jobs          Job[]          @relation("TechnicianJobs")
  rollCallUsers RollCallUser[]
  sessions      Session[]
}

model Job {
  id                 Int          @id @default(autoincrement())
  vehicleReg         String
  jobType            JobType
  status             JobStatus    @default(PENDING)
  scheduledDate      DateTime
  location           String?
  governorSerial     String?
  governorStatus     String?
  clientName         String?
  clientPhone        String?
  remarks            String?
  photoUrl           String?
  clientSignature    String?
  createdAt          DateTime     @default(now())
  technicianId       Int?
  assignedTechnician User?        @relation("TechnicianJobs", fields: [technicianId], references: [id])
  history            JobHistory[]
  photos             Photo[]
}

model Session {
  id         Int       @id @default(autoincrement())
  userId     Int
  loginTime  DateTime  @default(now())
  logoutTime DateTime?
  active     Boolean   @default(true)
  latitude   Float?
  longitude  Float?
  user       User      @relation(fields: [userId], references: [id])
}

model RollCallUser {
  id         Int       @id @default(autoincrement())
  rollCallId Int
  userId     Int
  checkIn    DateTime?
  checkOut   DateTime?
  latitude   Float?
  longitude  Float?
  status     String?
  rollCall   RollCall  @relation(fields: [rollCallId], references: [id])
  user       User      @relation(fields: [userId], references: [id])
}

model RollCall {
  id           Int            @id @default(autoincrement())
  date         DateTime       @default(now())
  region       String?
  presentUsers RollCallUser[]
}

model Photo {
  id         Int      @id @default(autoincrement())
  jobId      Int
  url        String
  uploadedAt DateTime @default(now())
  job        Job      @relation(fields: [jobId], references: [id])
}

model JobHistory {
  id        Int       @id @default(autoincrement())
  jobId     Int
  status    JobStatus
  remarks   String?
  latitude  Float?
  longitude Float?
  updatedBy Int
  createdAt DateTime  @default(now())
  job       Job       @relation(fields: [jobId], references: [id])
}

enum Role {
  ADMIN
  TECHNICIAN
  STAFF
}

enum JobType {
  INSTALL
  RENEWAL
  FAULT_CHECK
  REPAIR
}

enum JobStatus {
  PENDING
  IN_PROGRESS
  DONE
  NOT_DONE
  ESCALATED
}
